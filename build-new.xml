<project name="REXOS" default="all" basedir=".">

	<!-- Scipt to edit an property-->
	<scriptdef name="propertyreset" language="javascript" description="Allows to assign @{property} new value">
    	<attribute name="name"/>
    	<attribute name="value"/>
        project.setProperty(attributes.get("name"), attributes.get("value"));
	</scriptdef>

	<!-- Macro for echo. making bin directory and building in one call-->
	<macrodef name="buildjava">
   		<attribute name="dir"/>
   		<sequential>
   			<echo message="building @{dir}"/>
   			<mkdir dir="@{dir}/bin"/>
			<javac srcdir="@{dir}" includeantruntime="true" destdir="@{dir}/bin" classpath="${classpath}"/> 
		</sequential>
	</macrodef>

	<macrodef name="cleanjava">
   		<attribute name="dir"/>
   		<sequential>
   			<echo message="cleaning @{dir}"/>
   			<delete dir="@{dir}/bin"/>
		</sequential>
	</macrodef>

	<!-- export file-->
	<property name="classpath-export-file" value="${basedir}/.rexos-export"/>

	<!-- basic export format for writing to export file-->
	<property name="basic-export" value="export CLASSPATH=$CLASSPATH"/>

	<!-- standard classpath, add all basic libraries here-->
	<property name="classpath" value="${basedir}/libraries/mongo-2.9.3.jar:${basedir}/libraries/jade.jar:${basedir}/libraries/gson-2.2.2.jar"
		/>

	 
	<!-- reset the export file -->
	<delete file="${classpath-export-file}"/> 

	<!-- default target, for new targets add them in depends list-->	
	<target name="all" depends="libraries, mas">
        <!-- set the total classpath to the export file-->
        <echo file="${classpath-export-file}" append="true" message="${basic-export}:${classpath}"/>
	</target>

	<!-- libraries target-->
	<target name="libraries">
    	<ant antfile="build.xml" target="all" dir="libraries" inheritRefs="true" useNativeBasedir="true"/>        
	</target>

	<!-- mas target-->
	<target name="mas" depends="libraries">
    	<ant antfile="build.xml" target="all" dir="mas" inheritRefs="true" useNativeBasedir="true"/>        
	</target>


	<!-- clean target-->
	<target name="clean">
    	<ant antfile="build.xml" target="clean" dir="mas" inheritRefs="true" useNativeBasedir="true"/>
    	<ant antfile="build.xml" target="clean" dir="libraries" inheritRefs="true" useNativeBasedir="true"/>  
    </target>

</project>
